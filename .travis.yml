language:
- objective-c
- c++

compiler:
- clang

sudo: false
os: osx
osx_image: xcode7.3

script:
- mkdir build
- cd build
- cmake -G Xcode ..
- cmake --build . --config Release | sed 's/-Wl,-.*//g'
- ctest -C Release . -V
- cd ..
- PACKAGE_NAME=`echo $TRAVIS_REPO_SLUG | sed 's/.*\///g'`
- PACKAGE_REV=`echo $TRAVIS_COMMIT | sed -e 's/^[[:alnum:]]\{6\}/&-/g' | sed 's/-.*//'`
- mkdir $PACKAGE_NAME
- if [ -e package-info.json ]; then cp package-info.json $PACKAGE_NAME; fi
- for f in *.md; do [ -e "$f" ] && cp "$f" $PACKAGE_NAME ; done
- if [ -e icon.png ]; then cp icon.png $PACKAGE_NAME; fi
- if [ -d code ]; then cp -r code $PACKAGE_NAME; fi
- if [ -d docs ]; then cp -r docs $PACKAGE_NAME; fi
- if [ -d examples ]; then cp -r examples $PACKAGE_NAME; fi
- if [ -d extensions ]; then cp -r extensions $PACKAGE_NAME; fi
- if [ -d externals ]; then cp -r externals $PACKAGE_NAME; fi
- if [ -d extras ]; then cp -r extras $PACKAGE_NAME; fi
- if [ -d help ]; then cp -r help $PACKAGE_NAME; fi
- if [ -d init ]; then cp -r init $PACKAGE_NAME; fi
- if [ -d java-classes ]; then cp -r java-classes $PACKAGE_NAME; fi
- if [ -d java-doc ]; then cp -r java-doc $PACKAGE_NAME; fi
- if [ -d javascript ]; then cp -r javascript $PACKAGE_NAME; fi
- if [ -d media ]; then cp -r media $PACKAGE_NAME; fi
- if [ -d misc ]; then cp -r misc $PACKAGE_NAME; fi
- if [ -d patchers ]; then cp -r patchers $PACKAGE_NAME; fi
- if [ -e $PACKAGE_NAME/ReadMe-Public.md ]; then rm -f $PACKAGE_NAME/ReadMe.md; mv $PACKAGE_NAME/ReadMe-Public.md $PACKAGE_NAME/ReadMe.md; fi
- mkdir dist
- zip -r dist/$PACKAGE_NAME-$PACKAGE_REV.zip $PACKAGE_NAME

deploy:
  provider: s3
  access_key_id: AKIAIWE3SI2TMXC5AJBA
  secret_access_key:
    secure: ZaVrhWjxJGNscjmr9FMn07MS5NpquQK+3vjXjJll4DvSKuZcL2XGRchxnnU5pi4910uvhg74teWdhLkvDxQ8xJlMvy8zAHMKLY+HY7UKHzHVy5kcm/zG3Qwr/fIBrIGkaSKZPyXWFBZDZoo2FFM4Xw/NRbFyTrWI+r//Xdr103IQ734C2k/y2CxMaCQJM/hOm0mpRCr5jsuzucfHCND1pT0mMy6a3osJFz+cn+dK3d72VH+a/1DVaUC1O0MTfwnlo2hOUZ4Zt+xr+ZKdhzNcmjRcDrdjp9y8As6s3j0cE1nnujSoziwOdiNVPuH9y+0qX6g8j9cYIviFdK5Lf9jo62Wuq8EE2cJ0dOym+Fs0Eyn5+FAL9GQzFspyuQF2KETx8YZj94frtKPAbOnV4N0r6UPn68zDhgmz8tBbTemh6j9X3UPhLzWHhY03J6pYMV2E+s+X2aH4pxScYF136Q54IMWq98gEQRsew/l6otUHYKpLOoPkHp9VWFQtTlLJtx8O2m19ZhV+hirZwZxNHF1kD7wyGpi/LPhaGnnT7kxjlCjqdHcfEgvxzYTg1w2S7XF0WIbs7xyJAkex2cw5y6cVvJL2pIvQOc+bJ1Ctrdh28HKMrJ1QMnjUTZn9DDGKIFANlLVayP1VfPT63jUpYZ1WbFctvxTKnjLeTm+CkbpbNJU=
  bucket: cycling74-ci
  skip_cleanup: true
  local-dir: dist
  upload-dir: zero
  acl: public_read
  on:
    repo: Cycling74/zero
